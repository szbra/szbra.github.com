<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<script src="orion/plugin.js"></script>
	<script>
		/*jslint browser:true devel:true*/
		/*global window eclipse localStorage*/

		var orionJSON = localStorage.orion;
		var plugins = orionJSON ? JSON.parse(orionJSON).plugins : [];
	
		function renderPlugins() {
			var pluginsHTML	= "";	
			for (var i = 0; i < plugins.length; i++) {
				pluginsHTML += "<p><input type='button' value='-' style='width:2em;' onclick='removePlugin(" + i + ");'> " +  plugins[i] + "<\/p>";
			}
			pluginsHTML += "";
			document.getElementById("currentPlugins").innerHTML = pluginsHTML;
		}
		
		function removePlugin(index) {
			plugins.splice(index, 1);
			localStorage.orion = JSON.stringify({plugins: plugins});
			renderPlugins();
		}
		
		function addPlugin() {
			var plugin = document.getElementById("addPlugin").value;
			document.getElementById("addPlugin").value = "";
			if (plugin.length !== 0) {
				plugins.push(plugin);
				localStorage.orion = JSON.stringify({plugins: plugins});
				renderPlugins();
			}
		}
	
		window.onload = function() {
			renderPlugins();
			
			var provider = new eclipse.PluginProvider();
			var temp = document.createElement('a');
			temp.href = "index.html";
			// testing that command service handles image-less actions properly
			provider.registerServiceProvider("orion.navigate.command", {
				run: function(item) {
					return temp.href + "#" + item.Location;
				}
			}, {
				name: "Markdown Viewer",
				id: "sample.markdown.viewer",
				forceSingleItem: true,
				href: true,
				tooltip: "Render Markdown File",
				validationProperties: {"Name":"*.md"}
			});
			provider.registerServiceProvider("orion.page.link.related", {
			}, {
				id: "sample.markdown.viewer"
			});
			provider.connect();
		};
	</script>
</head>
<body>
	<b>Plugins:</b>
	<div id="currentPlugins"></div>
	<p><input type="button" value="+" style="width:2em;" onclick="addPlugin();"><input id="addPlugin" type="text" size="50"></p>

</body>
</html>